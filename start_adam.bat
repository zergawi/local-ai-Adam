@echo off
chcp 65001 >nul
title ??????? ?????? ???
color 0A

echo.
echo +--------------------------------------------------------------+
echo ¦                   ?? ??????? ?????? ???                     ¦
echo ¦                      ??? ??????? ??????                     ¦
echo ¦                                                              ¦
echo ¦  ?? ????? ????????  ?? ?????? ?? ??????  ?? ?????        ¦
echo ¦  ?? ????? ???????   ?? ????? ??????      ?? ?????? ?????? ¦
echo +--------------------------------------------------------------+
echo.

REM ?????? ?? Python
echo ?? ??? ??????? ??????...
python --version >nul 2>&1
if errorlevel 1 (
    echo ? Python ??? ???? ?? ??? ????? ?? PATH
    echo.
    echo ?? ?? ?????? Python ??: https://python.org
    echo    ???? ?? ????? Python ??? PATH ????? ???????
    echo.
    pause
    exit /b 1
)

echo ? Python ?????
for /f "tokens=2" %%i in ('python --version 2^>^&1') do echo    ???????: %%i

REM ?????? ?? ?????? ??????
if not exist "main.py" (
    echo.
    echo ? main.py ??? ????? ?? ??? ??????
    echo ?? ???? ?? ????? ???????? ?? ???? ??????? ??????
    echo    ?????? ??????: %CD%
    echo.
    pause
    exit /b 1
)

echo ? ??????? ???????? ??????

REM ?????? ?? ?????? ??????????
if exist ".venv1" (
    echo ?? ????? ?????? ??????????...
    call .venv1\Scripts\activate.bat
    if errorlevel 1 (
        echo ?? ?? ??? ????? ?????? ??????????
    ) else (
        echo ? ?? ????? ?????? ??????????
    )
) else if exist ".venv" (
    echo ?? ????? ?????? ??????????...
    call .venv\Scripts\activate.bat
    if errorlevel 1 (
        echo ?? ?? ??? ????? ?????? ??????????
    ) else (
        echo ? ?? ????? ?????? ??????????
    )
)

REM ??? ???????? ????????
echo.
echo ?? ??? ???????? ????????...
python -c "import pygame; print('? pygame ?????')" 2>nul || echo ? pygame ??? ?????
python -c "import edge_tts; print('? edge-tts ?????')" 2>nul || echo ? edge-tts ??? ?????
python -c "import speech_recognition; print('? speech-recognition ?????')" 2>nul || echo ? speech-recognition ??? ?????

echo.
echo ?? ????? ??????? ???...
echo.
echo ?? ??????? ?????????:
echo    1. ?? "???" ?????? ???????
echo    2. ????? ?? ???????
echo    3. ???? ??? ?? ???? ???:
echo       • "??? ??????"
echo       • "???? ???????"
echo       • "?? ????? ??????"
echo       • "???? ??????? ??????"
echo.
echo ?? ???? ?? ?? ?????????? ??????? ????? ????
echo ?? ???? Ctrl+C ?????? ???????
echo.
echo ?? ??? ???????...
echo ----------------------------------------------------------------

REM ????? ???????
python main.py

REM ?????? ???????
if errorlevel 1 (
    echo.
    echo ----------------------------------------------------------------
    echo ? ??? ??? ?? ????? ???????
    echo.
    echo ?? ?????? ????????:
    echo    1. ???? ?? ????? ???? ????????:
    echo       pip install -r requirements.txt
    echo.
    echo    2. ??? ??????? ??????:
    echo       python setup_complete.py
    echo.
    echo    3. ????? pygame:
    echo       python setup_pygame_audio.py
    echo.
    echo    4. ???? ?? ????? Ollama:
    echo       ollama serve
    echo       ollama pull command-r7b-arabic
    echo.
) else (
    echo.
    echo ----------------------------------------------------------------
    echo ?? ?? ????? ??????? ?????
    echo ?? ????? ???????? ??????? ?????? ???
)

echo.
pause